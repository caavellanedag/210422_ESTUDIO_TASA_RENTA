---
title: "METODOLOGÍA PARA LA ESTIMACIÓN DE LAS TASAS DE CAPITALIZACIÓN DE RENTAS DE INMUEBLES RESIDENCIALES, RESULTADOS PARA BOGOTÁ 2017-2021"
subtitle: Unidad Administrativa Especial de Catastro Distrital
author: "Grupo estadístico - Observatorio técnico catastral"
date: "01 de Junio de 2021"
site: "bookdown::bookdown_site"
lang: es-CO
fig_width: 4
fig_height: 2.5
fontsize: 12pt
header-includes:
   - \usepackage{amsmath}
   - \usepackage{graphics}
   - \usepackage[inline]{enumitem}
   - \usepackage{amsbsy}
   - \usepackage{multirow}
   - \usepackage{mathtools}
   - \usepackage{cancel}
   - \usepackage{url}
   - \usepackage{tikz}
   - \usepackage{float}
   - \usepackage{epstopdf}
   - \usepackage{enumitem}
   - \usepackage{bm}
   - \usepackage{color, colortbl}
   - \usepackage{natbib}
   - \usepackage{hyperref}
   - \usepackage{booktabs}
   - \usepackage{float}
   - \usepackage{fancyhdr}
output:
  bookdown::pdf_document2:
    citation_package: natbib
bibliography: references.bib
link-citations: true
urlcolor: blue
---

\addtolength{\headheight}{1.0cm} <!--% make more space for the header-->
\pagestyle{fancyplain} <!--use fancy for all pages except chapter start-->
\rhead{\includegraphics[height=2.0cm]{../input/logo.png}} <!-- right logo-->


```{r setup, include=FALSE}
require(tinytex)
options(kableExtra.latex.load_packages = FALSE)
#options( tinytex.verbose = TRUE)
knitr::opts_chunk$set(echo = TRUE)
options(tinytex.verbose = TRUE)
```




<!-- \begin{abstract} -->
<!-- Your abstract. -->
<!-- \end{abstract} -->

\section{Introducción}\label{section1}

La Unidad Administrativa Especial de Catastro Distrital -UAECD tiene por objeto responder por la recopilación e integración de la información georreferenciada de la propiedad inmueble del Distrito Capital en sus aspectos físico, jurídico y económico. Frente a esto, durante los últimos años la entidad ha enfocado esfuerzos para obtener datos del mercado inmobiliario que le permita apoyar el proceso de actualización catastral, afianzando el uso de métodos indirectos, y de manera general, para aportar conocimiento acerca del mismo. 

 

La UAECD recolecta ofertas de mercado de venta o arriendo, a través de recorridos sectorizados en la ciudad, que constituyen una importante fuente primaria. De manera complementaria y no menos importante, la entidad también obtiene ofertas de fuentes secundarias, gestionadas a través de convenios o acuerdos con entidades del sector público o privado. 

 

Particularmente, en ejercicios realizados al interior de la entidad, tendientes a estimar el valor integral de predios en propiedad horizontal, se han identificado dificultades relacionadas con la escasa o nula información en algunas localizaciones de la ciudad. Para superar esta problemática, surge la propuesta de utilizar la información de ofertas de mercado para estimar las tasas de capitalización de renta (TCR). 

 

Las TCR para inmuebles son índices (usualmente expresados en tasa) que relacionan el canon de arrendamiento y el valor de venta de activos inmobiliarios; son útiles en el campo de la valuación inmobiliaria porque permiten estimar el valor de mercado de un inmueble a partir del valor de arriendo o alquiler\footnote{ En el sector inmobiliario, son un referente para medir el retorno potencial en aquellas inversiones enfocadas a la compra de un inmueble para el alquiler o cuando los inmuebles hacen parte de portafolios de inversión donde son los subyacentes. En una escala más amplia, la de ciudad, permiten hacer seguimiento a la dinámica urbana, dadas las diferencias que el índice puede presentar en términos de ubicación, usos, estratos y edades de los inmuebles que componen el inventario de la ciudad, análisis que se incorpora en un segundo documento con base en el resultado del presente documento.}. 

Por lo anterior, este estudio tiene como objetivo principal proponer una metodología para la estimación de las TCR y hacer la estimación para inmuebles residenciales, según estratos y diferentes desagregaciones geográficas como lo son las localidades y sectores catastrales. 



En la información disponible para la realización de este documento, se encuentran las ofertas recolectadas\footnote{Las ofertas contenidas en la base consolidada por la UAECD, son capturadas en campo u obtenidas de fuentes secundarias (como portales inmobiliarios), las cuales son dispuestas por particulares o agencias inmobiliarias que proporcionan una valor de arriendo o de alquiler e información de ciertos atributos del inmueble. Teniendo en cuenta esto, los precios objeto de análisis corresponden a precios de expectativa y no a precios de transacción efectiva. Por tal razón no son comparables con resultados de ejercicios que trabajan con información de precios de cierre (en el caso de las ventas) o de alquiler neto al cual se descuentan valores puntuales de administración, impuesto predial, entre otros.} por la UAECD tanto de fuentes primarias como secundarias (Finca Raíz, Galería Inmobiliaria y Properati) desde el primero de enero de 2017 hasta el 31 de diciembre de 2020. Una limitante que se debe tener en cuenta es que los predios no tienen información de arriendo y venta de manera simultánea, lo que quiere decir que para cada oferta solamente se tiene una de las dos mediciones. En este documento únicamente se tendrán en cuenta las ofertas correspondientes a predios residenciales, es decir apartamentos y casas.

Dentro de la literatura se encuentran diversos ejemplos de datos donde se hacen mediciones o encuestas a grupos de individuos periódicamente, pero no necesariamente a las mismas personas, lo cual imposibilita hacer seguimientos sobre unidades en particular, de manera similar a la problemática presentada, donde no se cuenta con información de arriendo y venta en los mismos predios. \cite{deaton1985panel} propone un modelo para una muestra \textit{``pseudo-panel"}, que se construye con lo que denominan  cohortes, las cuales representan grupos de individuos con características similares, con la condición que cada individuo pertenezca únicamente a una cohorte durante todo el análisis y mediante estos grupos se ajustan efectos dentro de la regresión correspondientes a cada una de las diferentes cohortes. Muchas publicaciones que abordan diferentes contextos se han elaborado a partir del modelo propuesto por  \citet{deaton1985panel} (Ver \citet{tsai2014review, tovar2012analysis,sprietsma2012computers,antman2007earnings}, entre otros). La propuesta utilizada en este documento se basa en el uso de estas cohortes, agregando la información a nivel de sector catastral, tomando el promedio o la mediana como medidas de resumen, tanto para valores de arriendo como para valores de venta.

Las metodologías de regresión ajustadas por mínimos cuadrados ordinarios tienen como supuestos la independencia entre mediciones, lo cual no se cumple en este caso, ya que un sector catastral puede tener información en las diferentes vigencias, por lo que se propone la inclusión de factores en la regresión que permitan captar el efecto de las medidas repetidas sobre la variable respuesta. De esta manera, la metodología a utilizar corresponde a los modelos de efectos mixtos, donde los efectos fijos van a ser el conjunto de factores asociados al estrato, localidad y el valor de arriendo, mientras que los efectos aleatorios corresponden a la relación entre el valor de arriendo y de venta, segmentada para cada uno de los sectores catastrales. 

La programación realizada se realizó en el software R \citep{R}, en donde el procesamiento de información se llevó a cabo mediante los paquetes relacionados en el $tidyverse$ \citep{tidyverse}, mientras que los controles de calidad utilizaron funciones de la librería $qcc$ y $RecordLinkage$ (Ver \cite{qcc} y \cite{RecordLinkage}). La estimación de los parámetros del modelo se realizó mediante el paquete $nlme$ \cite{nlme}.

La organización del documento es la siguiente: la primera sección corresponde a esta introducción. La segunda sección presenta los objetivos del estudio. La tercera sección plantea el marco conceptual en el que se soporta en estudio. La cuarta sección describe de manera detallada la base de datos utilizada y los controles de calidad aplicados. En la quinta sección se presenta de manera general el modelo seleccionado y los resultados desagregados por tipo de inmueble (apartamentos o casas), con la correspondiente validación de supuestos. Y en la sexta sección, se incluyen las principales conclusiones. Finalmente, en el apéndice 1 contiene una descripción más detallada del modelo lineal mixto. 

\section{Objetivos}

Para el estudio, además del objetivo general, se definieron cinco objetivos específicos.  

\subsection{Objetivo general}

Proponer una metodología para la estimación de las TCR y hacer la estimación del índice para inmuebles residenciales de Bogotá, según estratos y diferentes desagregaciones geográficas como lo son las localidades y sectores catastrales. 


\subsection{Objetivos específicos}
 
 \begin{enumerate}
\item Identificar metodologías que sirvan de referencia para el desarrollo del estudio.

\item Realizar un análisis descriptivo de la base de datos disponible para la realización del ejercicio.

\item Detectar aquellas ofertas atípicas que puedan sesgar los resultados del estudio. 

\item Calcular las tasas de capitalización de rentas para inmuebles de uso residencial en diferentes desagregaciones: estrato, localidad y sector catastral 

 \item Presentar una documentación metodológica de los resultados 
 \end{enumerate}
\section{Marco conceptual}

\subsection{Universo de estudio}

El Universo de estudio para este documento corresponde al conjunto de predios urbanos en la ciudad de Bogotá en los años 2017 al 2020.

\subsection{Población objetivo}

La población objetivo corresponde a los predios residenciales, tanto de propiedad horizontal (PH) como no propiedad horizontal (NPH) en la ciudad de Bogotá comprendidos en los años 2017 al 2020. 


\subsection{Conceptos principales}
De acuerdo con \citet{godinez}, la tasa de capitalización se relaciona con el rendimiento de un capital invertido. Este autor indica que en “*el caso del negocio de arrendamiento de inmuebles, a la tasa de capitalización se le llama tasa de capitalización de rentas y se obtiene de la relación de la renta anual entre el valor comercial*”. 

Con el fin de no confundir el concepto de TCR con la rentabilidad total de la inversión con destino al alquiler, es de precisar que el primero está incorporado en el segundo. En otras palabras, la rentabilidad total tienes dos componentes: i) los ingresos por alquiler (capturados a través de las TCR) y el incremento nominal derivado de la diferencia en precios del inmueble (denominado valorización\footnote{Y que si se ajusta de acuerdo a la inflación, se obtiene la valorización real.}). 

La expresión matemática de la que se deduce la TCR se muestra en la ecuación \label{eqref0}, donde $P_k$ es el precio del $k$-ésimo inmueble, $R_k$ es su tasa de renta o alquiler e $i$ representa la respectiva TCR.

\begin{equation}\label{eqref0}
P_k = \frac{R_k}{i}
\end{equation}

En cuanto al numerador, el alquiler, la tasa puede tomar en consideración la renta bruta del inmueble o la neta, esta última calculada a partir de los ingresos brutos menos los descuentos por concepto de vacíos y cobranzas, gastos de operación y cuotas de mantenimiento, y por descuentos del régimen tributario (Medrano, Perlaza y Fuentes 2011). Otros autores, como en \citet{lonja}, deducen el gasto de administración, predial, administración inmobiliaria, vacancia y mantenimiento. 

 

Según \citet{borrero}, el alquiler opera como “un factor de ajuste entre la valorización del inmueble y la tasa media de ganancia de la economía más un factor de riesgo y un factor de liquidez.  En el caso de los inmuebles el factor de riesgo es casi nulo pero el factor de liquidez debe existir dado que no es fácil convertir el inmueble en dinero líquido”.  

 

Respecto del denominador, el precio del inmueble es de precisar concepto de valor de mercado, el cual se define como el precio de venta más probable, o lo que un inversionista típico está dispuesto a pagar por una propiedad. Por lo cual, al momento de hacer la medición de las TCR, algunos autores como \citet{medrano} descuentan del precio, un porcentaje de tasa de negociación. 

 

Conceptualmente, de la misma manera como una tasa de interés, que es el precio que tiene el dinero a través del tiempo en el mercado financiero, las TCR tienen periodicidades. Cuando el cálculo de la tasa de capitalización se estima a partir del flujo de interés de sólo un valor mensual de arrendamiento, se obtiene una tasa nominal mensual. Cuando se estima a partir de los flujos de renta en un año, corresponde a una tasa anual. 

 

\citet{montoya} indica que las tasas de rentabilidad de la inversión en bienes inmuebles se relacionan con el precio del inmueble, su ubicación, edad y estado legal y con la demanda del activo y la oferta de inmuebles similares, y con los criterios liquidez, los flujos de caja, el riesgo y los impuestos. \citet{alzate} cita que, contrario a la rentabilidad de una acción, que es la misma para todo un país, la de los inmuebles depende del sector donde se ubica la vivienda, y puede mostrar grandes variaciones entre sectores de una misma ciudad. 

 

En Colombia, la ley 820 de 2003 estipula los límites legales para la fijación de la renta de arrendamiento. Textualmente dice: “El precio mensual del arrendamiento será fijado por las partes en moneda legal pero no podrá exceder el uno por ciento ($1\%$) del valor comercial del inmueble o de la parte de él que se dé en arriendo”. 

 

Al respecto \citet{borrero} afirma que: “*es razonable afirmar que la renta de los inmuebles tiende al 1% mensual en condiciones de baja y media inflación. La tasa de renta sale por diferencia entre la rentabilidad media nacional y la valorización de los inmuebles más un premio por la iliquidez del mercado inmobiliario. Naturalmente que esta tasa oscilará de acuerdo con el momento del ciclo económico, el mercado inmobiliario, el estrato y el uso del inmueble en la zona*” 

 

 

Por su parte, la Resolución 620 de 2008, “Por la cual se establecen los procedimientos para los avalúos ordenados dentro del marco de la Ley 388 de 1997”, establece como parte de las técnicas valuatorias el método de capitalización de rentas\footnote{“ARTÍCULO 2o. MÉTODO DE CAPITALIZACIÓN DE RENTAS O INGRESOS. Es la técnica valuatoria que busca establecer el valor comercial de un bien, a partir de las rentas o ingresos que se puedan obtener del mismo bien, o inmuebles semejantes y comparables por sus características físicas, de uso y ubicación, trayendo a valor presente la suma de los probables ingresos o rentas generadas en la vida remanente del bien objeto de avalúo, con una tasa de capitalización o interés”.} los aspectos para tener en cuenta en la selección de la información y en la aplicación del método: 

1. Que dichos contratos tengan menos de un (1) año de suscritos. 

2. Que el canon de arrendamiento no sobrepase los topes legales. 

3. Que los montos relacionados con el pago de servicios públicos y las cuotas de administración, no se incluyan en el cálculo correspondiente para la aplicación del método. 

4. Los arrendamientos a comparar deben referirse a inmuebles que tengan rentas de acuerdo con la norma de uso del terreno o de las construcciones. 

5. Las rentas a tener en cuenta para el cálculo del valor comercial de la propiedad deben estar asociadas exclusivamente al inmueble y no a la rentabilidad de la actividad económica que en él se realiza. 

6. La tasa de capitalización (i) utilizada en este método debe proceder de la relación calculada entre el canon de renta y el valor comercial de las propiedades similares al inmueble objeto de avalúo, en función del uso o usos existentes en el predio y de localización comparable”.


\subsection{Antecedentes}  

 

Son pocas las metodologías documentadas de estimación de las TCR. El estudio de (Medrano, Perlaza, & Fuentes, 2011) propone como metodología para estimar la tasa de capitalización de la renta en vivienda en propiedad horizontal estrato 3 en PH en Bogotá un modelo de regresión lineal. Posteriormente, la publicación de \citet{valorar} que tiene como objetivo  la medición de inmuebles residenciales urbanos estrato 2, aunque no presenta de manera explícita la metodología, expone que, como resultado del ejercicio, las variables área de terreno, estado de conservación resultaron significativas y con mayor incidencia en la tasa de capitalización frente a las demás variables utilizadas, a saber, tipo de inmueble, área privada, ascensor, equipamiento, estado de conservación y edad. De manera general se concluye que, en este estrato, se observa una tasa mayor para apartamentos que para casas. 

Por otra parte, la UAECD y Camacol Bogotá Cundinamarca, en el año 2018, realizaron un primer ejercicio conjunto para el cálculo de la Tasa de Renta Inmobiliaria, calculadas para las desagregaciones geográficas con información de ofertas disponibles en el periodo 2016 2018. Como parte de las recomendaciones y resultados de dicho estudio, se encontró que era necesario mejorar la georreferenciación de las ofertas y aumentar la muestra, toda vez que en ciertas áreas no se logró obtener la correspondiente TCR. 

 
```{r include=TRUE,warning=FALSE,message=FALSE,echo=FALSE}
require(pacman)

source("src/Funciones.R")
p_load(tidyverse, openxlsx, here, haven, data.table, knitr, flextable, 
       officer, targets, kableExtra, targets, captioner, scales)

options(scipen=999)

tar_load(base)
tar_load(base_filtrada)
tar_load(df_clean)
tar_load(df_clean_final)
tar_load(list_whole_tables_PH)
tar_load(list_whole_tables_NPH)
tar_load(list_plots_model_PH)
tar_load(list_plots_model_NPH)
```





\subsection{Controles de calidad sobre la base}

La base de datos consta originalmente con `r labels(nrow(base))` registros, incluyendo todos los tipos de predios. Un primer filtro realizado corresponde a dejar aquellas ofertas de predios residenciales, es decir, cuyo tipo de inmueble es apartamento o casa. El total de registros residenciales es `r labels(sum(base$TIPO_INMUEBLE %in% c("APARTAMENTO","CASA")))`. Por otro lado, se tuvo en cuenta diferentes exclusiones para eliminar inconsistencias, dentro de las cuales se incluyen los casos que no tienen estrato, sin área construida, sin identificador del lote (barmanpre) y ofertas rurales. Es importante tener en cuenta que las exclusiones no son excluyentes, lo que quiere decir que un predio puede tener estar en dos o más exclusiones. Luego de estas exclusiones, el número de predios en la base para trabajar es `r labels(nrow(base_filtrada))`. En el cuadro \@ref(tab:exclusiones) se muestran el número de predios excluidos en cada caso. 

```{r exclusiones, echo = FALSE, warning = FALSE, message = FALSE}
Exclusiones <- data.frame("Exclusión" = c("Rurales", "Sin área", "Sin Barmanpre", "Sin estrato"),
N = labels(c(sum(substring(base$CODIGO_BARRIO,1,1) %in% c("1", "2")),
nrow(base[AREA_CONSTRUIDA == 0 | is.na(base$AREA_CONSTRUIDA)]),
nrow(base[base$BARMANPRE=="" | is.na(base$BARMANPRE)]),
nrow(base[base$ESTRATO == 0])) ))

Exclusiones %>%
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Número de predios en cada una de las exclusiones.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"))
```


Debido a que la base de datos tiene información de diferentes fuentes y estas contienen información reportada directamente por los usuarios de plataformas digitales, puede darse el caso en que se tengan valores mal digitados o ciertas inconsistencias. Para evitar estos casos se propone realizar controles sobre esta información, con el objetivo de que la información utilizada por el modelo lineal sea lo más depurada posible..

La información a utilizar dentro de los diferentes modelos consiste en las áreas de construcción, precios reportados y los valores integrales. Considerando que se cuenta con datos, por un lado de ventas y arriendo, mientras que por otra parte predios en propiedad horizontal (PH) y no propiedad horizontal (NPH), además de diferentes estratos, se van a conformar diferentes agrupaciones de manera inicial. Las agrupaciones dependen del año de recolección del dato, clase de predio (PH y NPH), estrato y tipo de oferta (arriendo y venta). Es decir que, por ejemplo, las ofertas de arriendo en PH no se van a comparar con ofertas en arriendo en NPH, ni entre vigencias o entre estratos, ya que de antemano se espera que tengan un comportamiento diferente. Una vez se conforman estas agrupaciones, lo ideal es realizar comparaciones entre ofertas que sean próximas desde una perspectiva geográfica. Estas comparaciones se realizan con el objetivo de determinar si la oferta es similar en sus características a ofertas, debido a que en otro caso la información recolectada en ese registro presentaría anomalías y debería reportarse como atípica, al mismo tiempo que ser excluida de los análisis a desarrollar. 

Una manera de determinar registros próximos geográficamente, es seleccionando todos los que se encuentren en el mismo sector catastral, pero un primer inconveniente surge cuando en un sector solamente se encuentre una oferta o un número insuficiente de ofertas para realizar la comparación. Por este motivo, se observa la necesidad de realizar aglomeraciones más grandes de tal forma que se tengan grupos con un número suficiente de información para realizar la validación. Es importante mencionar que si el número de registros supera el umbral determinado, no se requiere una agrupación más grande y se va a aplicar el protocolo de comparación únicamente con las ofertas que se encuentran en ese barrio. 

Con el objetivo de tener agrupaciones de ofertas lo suficientemente grandes para tener información y realizar la comparación, pero de tal forma que no se agregue demasiado, considerando la singularidad de cada sector, en este documento se propone agrupar los sectores de acuerdo a su codificación. Se esperaría que los sectores cuya codificación es igual a diferencia del último dígito son más cercanos que dos sectores que tienen diferencias en sus dos últimos dígitos. Por ejemplo, se esperaría que los sectores "001101" y "001102" sean próximos geográficamente hablando. De esta manera, el algoritmo propuesto busca estas coincidencias a partir de la distancia de Levenshtein \citep{RecordLinkage}, la cual es un valor entre 0 y 1. Esta distancia toma un valor de 0 cuando las dos codificaciones no tienen dígitos en común en las mismas posiciones y toma el valor de 1 cuando son exactamente iguales. El algoritmo realiza la búsqueda iterativa de sectores similares, iniciando por los últimos dígitos, de forma que si no encuentra sectores con el mismo código y último dígito diferente, procede a buscar coincidencias exceptuando los dos últimos dígitos y así sucesivamente hasta superar el umbral definido. Una vez el algoritmo encuentra agrupaciones tal que todas superan dicho valor predefinido se detiene y no continua con el proceso de agregación. El número de predios determinado, como umbral es 10, lo cual quiere decir que si un sector catastral cuenta con menos de 10 registros a nivel de tipo de oferta, estrato, clase de predio y año, se buscarán opciones de colapso, de tal forma que se encuentren ofertas próximas para poder realizar la comparación.

Una vez se conforman las diferentes agrupaciones se procede a utilizar una carta de control multivariada \citep{montgomery2020introduction}, lo que se debe a que se están controlando diferentes características, es decir un proceso multivariado, al involucrar el área construida, precio y el valor integral de las diferentes ofertas. Al considerar una carta de control multivariada se hace uso de la relación implícita dentro de las variables, lo cual no sucede con métodos univariados. Los métodos de control de calidad usualmente consideran dos etapas, lo que no se tiene en cuenta dentro de este ejercicio ya que no se tendrán en cuenta ofertas adicionales en este ejercicio y a por otra parte, el objetivo del estudio no se enfoca en el control de calidad, si no que éste es un paso adicional para lograr el objetivo, el cual radica en la estimación de la tasa de capitalización. La figura \@ref(fig:plt) muestra un ejemplo de una carta de control multivariada, donde las ofertas se ilustran a partir de puntos, las bandas determinan límites de tal forma que una oferta que está fuera de ellos será marcada como atípica y se muestran en el gráfico en color rojo.

```{r plt, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Ilustración de la carta de control multivariada.", fig.height = 3.7, fig.width = 3.5}
lista_separada <- base_filtrada %>% split(.$key) %>% map(Fill_na) 
lista_2 <- map(lista_separada, ~Agrupa_barrios(.x, cutoff = 10))

lista_2[[1]] %>%
  filter(CODIGO_BARRIO_NEW == lista_2[[1]]$CODIGO_BARRIO_NEW[1]) %>% 
  make_control_chart() %>% make_plot_qcc() + ylab("Estadística calculada")
```

Luego de este control de calidad, la base de datos tiene un total de `r labels(nrow(df_clean))` registros, con lo cual se procede a realizar los diferentes cálculos de promedios por sector, de tal manera que en cada uno de ellos se tendrá un promedio de venta y de arriendo, por estrato, vigencia y clase de predio (apartamento o casa). Al realizar este cálculo se tuvo un inconveniente, ya que un sector puede tener ofertas de arriendo, más no de ventas o viceversa. Para remediar esto, en el caso en que se tenga información de arriendo y no de ventas, se toma el promedio de valor integral de la base catastral, de acuerdo a la misma desagregación. Mientras que en el recíproco, cuando se tiene el valor de venta, pero no en el de arriendo se utiliza el promedio de la localidad respectivo para imputar este valor y proceder con la construcción del modelo estadístico.


Considerando que se elaboró una serie de procedimientos, controles de calidad, depuraciones e imputaciones se realizó un análisis para excluir registros que tuvieran tasas de renta atipicas, que puedan sesgar los resultados del estudio. Para esta situación, se excluyeron aquellos casos con una tasa de capitalización superior al $1\%$ o inferiores al $0.33\%$.
Luego de este proceso, la tabla \@ref(tab:resumenbase) muestra el número de sectores resultantes, la cantidad de registros de ofertas y de ventas utilizadas en cada caso, respectivamente, donde se observa que la cantidad de ofertas de venta es mayor a la de arriendo y se encuentran cantidades mayores en estratos del 2 al 4. 

```{r resumenbase, echo = FALSE, message = FALSE, warning = FALSE}
df_clean_final$bd_in %>%
  mutate(ESTRATO = as.character(ESTRATO), ANO = as.character(ANO)) %>% 
  dplyr::select(ESTRATO, ANO, CLASE_PREDIO, N_ARRIENDO, N_VENTA) %>% 
  group_by(CLASE_PREDIO, ANO, ESTRATO) %>% 
  summarise("N de sectores" = n(),
            "N de ofertas de arriendo" = sum(N_ARRIENDO, na.rm = TRUE), 
            "N de ofertas de venta" = sum(N_VENTA, na.rm = TRUE)) %>% 
  ungroup() %>% 
  rbind(c("Total", "Total", "Total",
                   df_clean_final$bd_in %>% nrow(),
                   df_clean_final$bd_in$N_ARRIENDO %>% sum(na.rm = TRUE),
                   df_clean_final$bd_in$N_VENTA %>% sum(na.rm = TRUE))
  ) %>% as.data.frame() %>% rename("AÑO" = ANO) %>% 
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Cantidad de predios y sectores según clase de predio, estrato y año, luego de la depuración de la base.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"), full_width = F) %>% 
  column_spec(4, width = "3em") %>% 
  column_spec(5, width = "5em") %>% 
  column_spec(6, width = "5em")
```


\section{Modelo aplicado}

El objetivo de esta sección es ilustrar el modelo estadístico aplicado junto con una breve justificación de su uso y respectivos resultados. Para eliminar el efecto que pueda tener el área construida sobre los valores de venta y de arriendo totales se va a tomar el valor integral, que se calcula dividiendo los valores totales sobre el área construida, es decir, lo que se muestra en la ecuación \eqref{eq_int}. En este modelo la variable respuesta es el valor integral de venta, mientras que una de las variables independientes es el valor integral de arriendo. 

\begin{equation}\label{eq_int}
Valor\_integral = \frac{Valor\_total}{Area\_construida}
\end{equation}

Considerando que no se cuenta con información de ventas y arriendo de manera simultánea en un solo predio, se toma la propuesta dada en \citet{deaton1985panel}, cuyas cohortes van a estar representadas por los diferentes sectores catastrales. De esta manera, el modelo estimado se presenta en la ecuación \eqref{eq_mod}, donde $P_{ij}$ y $R_{ij}$ representan los valores integrales de venta y arriendo promedio, respectivamente, en el $i$-ésimo sector catastral en el $j$-ésimo tiempo,  $\alpha$ es el efecto global del valor integral de arriendo sobre el valor integral de venta. Por otro lado, $\beta_k$ es el efecto del $k$-ésimo estrato sobre el efecto general de la relación entre valores integrales, denotado como $\alpha$, $\eta_l$ es el efecto de la $l$-ésima localidad sobre el efecto general de la relación entre integrales, $\delta_m$ es el efecto del $m$-ésimo sector catastral sobre el efecto global y $\kappa_p$ es el efecto del $p$-ésimo año, de manera análoga a los otros coeficientes. Por último $\epsilon_{ij}$ representa a los errores de la regresión. 

\begin{equation}\label{eq_mod}
P_{ij} = \alpha R_{ij} + \beta_k R_{ij} + \eta_l R_{ij} +  \kappa_p  R_{ij}+  \delta_m R_{ij} + \epsilon_{ij}
\end{equation}

En el caso del modelo \eqref{eq_mod}, los factores relacionados al estrato y localidad son efectos fijos, ya que en la base de ofertas utilizada se tiene información de todos los estratos y de todas las localidades, mientras que los efectos relacionados con los sectores catastrales son efectos aleatorios, debido a que no se tienen mediciones de todos los sectores en la ciudad de Bogotá, pero la inferencia a realizar se puede generalizar a la población de sectores. Como en el modelo \eqref{eq_mod} se incluyen efectos fijos y aleatorios, el modelo se denomina de efectos mixtos.

En este modelo se supone lo siguiente

$$
\sum_k \beta_k = \sum_l \eta_l = 0,
$$

\noindent lo cual se debe a temas relacionados con la estimabilidad de los parámetros. Por otro lado, en cuanto a los factores aleatorios, se supone que los coeficientes y errores son independientes e idénticamente distribuidos y a su vez $\delta_m \sim N(0, \sigma_\delta^2)$ y $\epsilon_m \sim N(0, \sigma_\epsilon^2)$. Es necesario tener en cuenta que el modelo no incluye intercepto, considerando los objetivos del estudio. El valor integral de arriendo, denotado por $R_{ij}$ se incluye en todas las covariables, ya que el objetivo es determinar la relación entre los valores totales y de arriendo. Para esclarecer el proceso de estimación de la tasa de rentabilidad, el lector puede notar que la ecuación \eqref{eq_mod} se puede reexpresar como sigue

$$P_{ij} = \left[ \alpha + \beta_k + \eta_l  + \kappa_p + \delta_m \right] R_{ij} + \epsilon_{ij},$$
donde se observa que la tasa de renta, se va a calcular a partir de la suma de los respectivos coeficientes, según sea el caso.

Una vez se realizó la estimación de los coeficientes del modelo, se realizó un análisis para determinar puntos de apalancamiento o de influencia, con el fin de encontrar aquellos casos donde un solo registro pueda influir y cambiar los coeficientes del modelo de manera importante. Para ello se realizó el cálculo de la distancia de $Cook$ y de los $DFBETAS$, que son medidas de diagnóstico del modelo. Detalles adicionales relacionados con modelos lineales de efectos mixtos o estas medidas de diagnóstico se pueden consultar en el anexo de este documento, en \citet{montgomery2012introduction}, \citet{hinkelmann2011design} o \citet{Melo}.

A partir de este modelo se estima un coeficiente, mayor a 1, que nos permite conocer la razón entre el valor integral de venta y el valor integral o dicho de otra manera un valor que al multiplicarlo por el valor de arriendo, nos permita estimar el valor total de venta, pero para temas interpretativos con otras áreas de la Unidad e inclusive con la literatura relacionada, en los resultados presentados se va a mostrar el inverso de ese coeficiente, que va a ser un valor entre 0 y 1. 

\subsection{Apartamentos}

A continuación se presentan los resultados de las diferentes tasas de rentabilidad para el caso de ofertas en propiedad horizontal. La figura \@ref(fig:scph) muestra diferentes diagramas de dispersión correspondientes a valores promedio de arriendo y de venta para los estratos en cada recuadro y diferentes años, representados por colores, para el caso de apartamentos. Allí se observa una relación lineal, lo cual justifica el uso del modelo \eqref{eq_mod} para este grupo de ofertas, al igual que una pendiente más empinada a medida que el estrato aumenta, lo que se refleja en una tasa de renta más baja para estratos altos y un comportamiento similar año a tras año.

```{r scph, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Diagrama de dispersión de los valores integrales de venta y de arriendo con sus respectivas rectas de regresión ajustadas por estrato y vigencia para apartamentos.", fig.height = 3.7}
list_plots_model_PH$scatterplot_estrato + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

\subsubsection{Resultados}



La tabla \@ref(tab:estph) y la tabla \@ref(tab:locph) muestran los resultados correspondientes a las tasas de renta a nivel de estrato y año, y a nivel de localidad y año. En el primer cuadro se observa que a medida que el estrato aumenta, la tasa de rentabilidad es menor. Las tasas de renta de los estratos 1 y 2 oscilan al rededor de $0.55\%$. En el estrato 3 se tienen valores cercanos al $0.51\%$, mientras que en el 4 y 5 se tienen valores cercanos al $0.49\%$ y por último en el 6 se tiene una tasa de renta cercana al $0.46\%$ a través de los diferentes años considerados.  En el cuadro \@ref(tab:locph) se observa que las localidades con mayores tasas de renta son Chapinero, La Candelaria y San Cristobal. Por otro lado, la localidad con menor tasa de rentabilidad es Puente Aranda. Las figuras \@ref(fig:tasaphest) y \@ref(fig:tasaphloc) muestran los mismos resultados de una manera gráfica.

```{r estph, warning = FALSE, message = FALSE, echo = FALSE}
Localidad <- read.xlsx("input/Localidad.xlsx")
list_whole_tables_PH$tabla_tasa_final_est %>%
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  rename("AÑO" = A) %>%   
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para apartamentos según estratos y años.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"))
```



```{r tasaphest, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Tasas de capitalización para apartamentos según estratos y años.", fig.height = 3.7}
list_whole_tables_PH$tabla_tasa_final_est %>%  
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)*100) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  ggplot() + geom_col(aes(ESTRATO,TASA_RENTA, fill = A), position = "dodge") +
  scale_y_continuous(limits = c(0.45, 0.565), oob = rescale_none) +
  theme_bw() +
  scale_fill_brewer(palette = "Set1") +
  labs(fill = "Año") +
  xlab("Estrato") +
  ylab("Tasa de renta en %")
```


```{r locph, warning = FALSE, message = FALSE, echo = FALSE}
list_whole_tables_PH$tabla_tasa_final_loc %>%  
  left_join(Localidad, by = "CODIGO_LOCALIDAD") %>% 
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  dplyr::select(A, CODIGO_LOCALIDAD, NOMBRE_LOCALIDAD, TASA_RENTA) %>% 
  rename("AÑO" = A) %>%   
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para apartamentos según localidades y años.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"))
```

```{r tasaphloc, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Tasas de capitalización para apartamentos según localidades y años.", fig.height = 3.7}
list_whole_tables_PH$tabla_tasa_final_loc %>%  
  left_join(Localidad, by = "CODIGO_LOCALIDAD") %>% 
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)*100) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  ggplot() + geom_col(aes(NOMBRE_LOCALIDAD,TASA_RENTA, fill = A), position = "dodge") +
  scale_y_continuous(limits = c(0.4, 0.6), oob = rescale_none) +
  theme_bw() +
  scale_fill_brewer(palette = "Set1") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(fill = "Año") +
  xlab("Nombre de la localidad") +
  ylab("Tasa de renta en %")
```



```{r resfittedph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Diagrama de dispersión de los residuales de la regresión versus los valores ajustados en el modelo de apartamentos.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_PH$plot_fitted_residuals 
```


```{r resboxph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Diagramas de cajas y bigotes de los residuales de la regresión versus los estratos para diferentes vigencias en el modelo de apartamentos.", fig.height = 3.7}
list_plots_model_PH$plot_boxplot_estrato_vigencia
```


```{r ranefph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Densidad estimada de los efectos aleatorios asociados a los sectores en el modelo de apartamentos.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_PH$plot_normal_ranef
```



```{r resph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Densidad estimada de los residuales obtenidos en la regresión para el caso de apartamentos.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_PH$plot_normal_residuals
```


\subsubsection{Validación de supuestos}

A manera de verificación de los supuestos del modelo para el grupo de ofertas de apartamentos, se realizó un análisis sobre los residuales del modelo. Las figuras \@ref(fig:resfittedph) y \@ref(fig:resboxph) son gráficos de dispersión y de cajas y bigotes, que ilustran la relación entre los residuales con los valores ajustrados, con los estratos y años, respectivamente. El objetivo de estas dos figuras es buscar patrones en los gráficos. Como se puede observar, no se encuentra una relación en los gráficos presentados. 

Por otro lado, se validó el supuesto de normalidad incluido en los efectos aleatorios del modelo dado en la ecuación \eqref{eq_mod}. Para ello, las figuras  \@ref(fig:ranefph) y \@ref(fig:resph) muestran las densidades estimadas para los efectos aleatorios asociados a los sectores catastrales y a los residuales del modelo, respectivamente. En ambos casos se observa una forma acampanada, por lo cual se puede suponer que en ambos casos, los valores provienen de una distribución normal.






\subsection{Casas}

A continuación se presentan los resultados de las diferentes tasas de rentabilidad para el caso de ofertas en no propiedad horizontal. La figura \@ref(fig:scnph) muestra diferentes diagramas de dispersión correspondientes a valores promedio de arriendo y de venta para los estratos en cada recuadro y diferentes años, representados por colores, para el caso de casas. Allí se observa una relación lineal, lo cual justifica el uso del modelo \eqref{eq_mod} para este grupo de ofertas, al igual que una pendiente más empinada a medida que el estrato aumenta y un comportamiento similar año a través de los años.


```{r scnph, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Diagrama de dispersión de los valores integrales de venta y de arriendo con sus respectivas rectas de regresión ajustadas por estrato y vigencia para apartamentos.", fig.height = 3.7}
list_plots_model_NPH$scatterplot_estrato + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

\subsubsection{Resultados}

El procedimiento en esta sección es análogo a lo presentado en el caso de propiedad horizontal. 
Las tablas \@ref(tab:estnph) y \@ref(tab:locnph) muestran los resultados para casas a nivel de estratos y localidades en las diferentes vigencias. Allí se observa, al igual que en el caso de la propiedad horizontal, que a medida que el estrato aumenta la tasa de rentabilidad es más baja. Las localidades con una mayor tasa de rentabilidad en casas son Chapinero, Los Mártires y Santa Fé, mientras que las de menor tasa son Bosa y Puente Aranda. Las figuras \@ref(fig:tasanphest) y \@ref(fig:tasanphloc) muestran los mismos resultados de una manera gráfica. Para el caso de casas, a diferencia del de apartamentos, en el 2020 se observa una diferencia más notoria con respecto a los otros años, ya que en dicho año se tiene una tasa de renta más baja en comparación con los otros, mientras que en 2019 se tuvo la tasa más alta, seguida de 2017 y de 2018.

```{r estnph, warning=FALSE,message=FALSE,echo=FALSE}
list_whole_tables_NPH$tabla_tasa_final_est %>% 
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  rename("AÑO" = A) %>%   
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para casas según estrato y años.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"))
```

```{r locnph, warning=FALSE,message=FALSE,echo=FALSE}
list_whole_tables_NPH$tabla_tasa_final_loc %>% 
  left_join(Localidad, by = "CODIGO_LOCALIDAD") %>% 
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  dplyr::select(A, CODIGO_LOCALIDAD, NOMBRE_LOCALIDAD, TASA_RENTA) %>% 
  rename("AÑO" = A) %>%   
  kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para casas según localidades y años.") %>% 
  kable_styling(latex_options = c("hold_position",  "repeat_header", "striped"))
```






```{r tasanphest, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Tasas de capitalización para casas según estratos y años.", fig.height = 3.7}
list_whole_tables_NPH$tabla_tasa_final_est %>%  
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)*100) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  ggplot() + geom_col(aes(ESTRATO,TASA_RENTA, fill = A), position = "dodge") +
  scale_y_continuous(limits = c(0.42, 0.62), oob = rescale_none) +
  theme_bw() +
  scale_fill_brewer(palette = "Set1") +
  labs(fill = "Año") +
  xlab("Estrato") +
  ylab("Tasa de renta en %")
```


```{r tasanphloc, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Tasas de capitalización para casas según localidades y años.", fig.height = 3.7}
list_whole_tables_NPH$tabla_tasa_final_loc %>%  
  left_join(Localidad, by = "CODIGO_LOCALIDAD") %>% 
  mutate(TASA_RENTA = round(1/TASA_RENTA, 5)*100) %>% 
  dplyr::select(-"TASA_RENTA_2") %>% 
  ggplot() + geom_col(aes(NOMBRE_LOCALIDAD,TASA_RENTA, fill = A), position = "dodge") +
  scale_y_continuous(limits = c(0.5, 0.95), oob = rescale_none) +
  theme_bw() +
  scale_fill_brewer(palette = "Set1") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(fill = "Año") +
  xlab("Nombre de la localidad") +
  ylab("Tasa de renta en %")
```
  





\subsubsection{Validación de supuestos}



```{r resfittednph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Diagrama de dispersión de los residuales de la regresión versus los valores ajustados en el modelo de casas.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_NPH$plot_fitted_residuals 
```


```{r resboxnph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Diagramas de cajas y bigotes de los residuales de la regresión versus los estratos para diferentes vigencias en el modelo de casas.", fig.height = 3.7}
list_plots_model_NPH$plot_boxplot_estrato_vigencia
```



```{r ranefnph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Densidad estimada de los efectos aleatorios asociados a los sectores en el modelo de casas.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_NPH$plot_normal_ranef
```



```{r resnph, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Densidad estimada de los residuales del modelo en el grupo de ofertas referente a casas.", fig.width = 3.6, fig.height = 3.7}
list_plots_model_NPH$plot_normal_residuals
```


A manera de verificación de los supuestos del modelo para el grupo de ofertas de apartamentos, se realizó un análisis sobre los residuales del modelo. Las figuras \@ref(fig:resfittednph) y \@ref(fig:resboxnph)  son
gráficos de dispersión y de cajas y bigotes, que ilustran la relación entre los residuales con los valores ajustrados, con los estratos y años, respectivamente. Por otro lado, se validó el supuesto de normalidad incluido en los efectos aleatorios del modelo dado en la ecuación \eqref{eq_mod}. Para ello, las figuras  \@ref(fig:ranefnph) y \@ref(fig:resnph) muestran las densidades estimadas para los efectos aleatorios asociados a los sectores catastrales y a los residuales del modelo, respectivamente. Las conclusiones de estos gráficos son las mismas a las presentadas para la validación de supuestos en apartamentos.


Es importante mencionar que las tasas de rentabilidad obtenidas para las ofertas en propiedad horizontal son mayores, por lo general a las que corresponden a no propiedad horizontal. Por último, los resultados obtenidos a nivel como sector se calcularon y hacen parte de los resultados de este documento, pero teniendo en cuenta que son tablas con un número de filas considerable, se omiten en este escrito. 

\section{Conclusiones}

En este trabajo se realizó la estimación de la tasa de rentabilidad para predios residenciales a diferentes niveles de desagregación, a partir de métodos de regresión tradicionales, utilizando la información de ofertas de mercado que han sido capturadas en los últimos años por la UAECD, superando la limitación de trabajar con fuentes con precios de venta y arriendo para un mismo predio. En consecuencia, se constituye en una herramienta alternativa para obtener tasas de capitalización de rentas. 

Los resultados obtenidos son a nivel de sector, año, clase de predio, localidad y estrato. En este documento se omiten los resultados a nivel de sector, debido a su tamaño. Las tasas de rentabilidad obtenidas para casas (NPH) son menores que las calculadas para apartamentos (PH). Se observa una relación inversamente proporcional entre el estrato y las tasas. 

Para el caso NPH, las localidades con una mayor tasa de rentabilidad en casas son Chapinero, Los Mártires y Santa Fé, mientras que las de menor tasa son Bosa y Puente Aranda, mientras que en el caso PH las localidades con mayores tasas de renta son Chapinero, La Candelaria y San Cristobal. Por otro lado, la localidad con menor tasa de rentabilidad es Puente Aranda.


\section{Trabajo futuro}

* A partir de una depuración de la información, en futuros ejercicios se podría incluir la edad de los inmuebles como una variable independiente adicional en los modelos para obtener su tasa de rentabilidad asociada. 

* Realizar estimaciones para usos diferentes al residencial.



<!-- La base de datos consta originalmente con `r labels(nrow(base))` registros. El resumen del número de registros, antes de realizar ciertas exclusiones se presenta en la siguiente tabla, la cual muestra el número de ofertas por fuente. -->


<!-- ```{r echo=FALSE,message=FALSE,warning=FALSE} -->
<!-- theme_box(autofit(flextable(base[,.N,by=.(NOMBRE_FUENTE)]))) -->
<!-- ``` -->






<!-- Inicialmente se filtraron aquellos registros que no cuentan con identificador, precio o barmanpre. Posterior a esta revisión se excluyeron los registros que no tenían área construida (2) y aquellos casos que no tenían área de terreno cuando el tipo de inmueble es diferente a apartamentos (2). A partir de esta base depurada se realizaron los siguientes conteos y gráficos de tipo descriptivo. Luego de estas exclusiones, se tiene un restante de `r labels(nrow(base_filtrada))` ofertas, las cuales son tenidas en cuenta dentro de los siguientes gráficos y tablas descriptivas. -->






<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[,.N,by=.(TIPO_INMUEBLE)][order(TIPO_INMUEBLE),LABELS:=labels(N)][N>2000] %>%  -->
<!--   ggplot()+geom_col(aes(x=fct_reorder(TIPO_INMUEBLE,N,.desc=TRUE),y=N),fill="red",position="dodge")+ -->
<!--   geom_text(aes(x=fct_reorder(TIPO_INMUEBLE,N,.desc=TRUE),y=N,label=LABELS),vjust=-0.6,position = position_dodge(width = 1))+ylab("N?mero de ofertas")+xlab("AÑO")+ -->
<!--   scale_y_continuous(labels=labels)+ -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1))  -->
<!-- ``` -->

<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[TIPO_INMUEBLE %in% c("APARTAMENTO","CASA"),.N,by=.(TIPO_INMUEBLE,ESTRATO)][order(TIPO_INMUEBLE,ESTRATO),LABELS:=labels(N)] %>%  -->
<!--   ggplot()+geom_col(aes(x=ESTRATO,y=N),fill="red",position="dodge")+ -->
<!--   geom_text(aes(x=ESTRATO,y=N,label=LABELS),vjust=-0.6,position = position_dodge(width = 1))+ylab("N?mero de ofertas")+xlab("ESTRATO")+ -->
<!--   scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+ -->
<!--   scale_x_continuous(breaks=0:6)+ -->
<!--   facet_wrap(~TIPO_INMUEBLE,scales="free") -->
<!-- ``` -->





<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[,.N,by=.(ANO,NOMBRE_FUENTE)][order(ANO,NOMBRE_FUENTE),LABELS:=labels(N)] %>%  -->
<!--   ggplot()+geom_col(aes(x=ANO,y=N,fill=NOMBRE_FUENTE),position="dodge")+ -->
<!--   geom_text(aes(x=ANO,y=N,label=LABELS,group=NOMBRE_FUENTE),vjust=-0.6,position = position_dodge(width = 1))+ylab("Número de ofertas")+xlab("Año")+ -->
<!-- scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+scale_fill_brewer(palette="Set1") -->
<!-- ``` -->

<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[,.N,by=.(ANO,TIPO_OFERTA)][order(ANO,TIPO_OFERTA),LABELS:=labels(N)] %>%  -->
<!--   ggplot()+geom_col(aes(x=ANO,y=N,fill=TIPO_OFERTA),position="dodge")+ -->
<!--   geom_text(aes(x=ANO,y=N,label=LABELS,group=TIPO_OFERTA),vjust=-0.6,position = position_dodge(width = 1))+ylab("Número de ofertas")+xlab("Año")+ -->
<!--   scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+scale_fill_brewer(palette="Set1") -->
<!-- ``` -->
<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[,.N,by=.(ANO,CLASE_PREDIO)][order(ANO,CLASE_PREDIO),LABELS:=labels(N)] %>%  -->
<!--   ggplot()+geom_col(aes(x=ANO,y=N,fill=CLASE_PREDIO),position="dodge")+ -->
<!--   geom_text(aes(x=ANO,y=N,label=LABELS,group=CLASE_PREDIO),vjust=-0.6,position = position_dodge(width = 1))+ylab("Número de ofertas")+xlab("Año")+ -->
<!--   scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+scale_fill_brewer(palette="Set1") -->
<!-- ``` -->

<!-- ```{r echo=FALSE,warning=FALSE,message=FALSE} -->
<!-- base_filtrada[,.N,by=.(ANO,TIPO_INMUEBLE)][order(ANO,TIPO_INMUEBLE),LABELS:=labels(N)][N>2000] %>%  -->
<!--   ggplot()+geom_col(aes(x=fct_reorder(TIPO_INMUEBLE,N,.desc=TRUE),y=N),fill="red",position="dodge")+ -->
<!--   geom_text(aes(x=fct_reorder(TIPO_INMUEBLE,N,.desc=TRUE),y=N,label=LABELS),vjust=-0.6,position = position_dodge(width = 1))+ylab("N?mero de ofertas")+xlab("AÑO")+ -->
<!--   scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+facet_wrap(~ANO,scales="free")+ -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1))  -->
<!-- ``` -->

<!-- ```{r echo=FALSE} -->
<!-- theme_box(autofit(flextable(base_filtrada[,.N,by=.(AÑO,TIPO_INMUEBLE)][order(AÑO,TIPO_INMUEBLE)]))) -->
<!-- ``` -->

<!-- ```{r echo=FALSE} -->
<!-- theme_box(autofit(flextable(base_filtrada[,.N,by=.(AÑO,TIPO_OFERTA,NOMBRE_FUENTE)][order(AÑO,TIPO_OFERTA,NOMBRE_FUENTE),]))) -->
<!-- ``` -->



\section{Anexo 1}\label{section_marco}

En esta sección se presenta una descripción, de manera corta, del modelo lineal de efectos mixtos, el cual fue utilizado en el documento para realizar las estimaciones requeridas dentro de los objetivos. Adicional a esta descripción se adicionan algunos criterios de validación que también fueron utilizados.

\subsection{Modelo lineal mixto}

Los modelos lineales son una forma de explicar la dispersión de una o más respuestas aleatorias en términos de una serie de variables independientes (también conocidas como exógenas).
En \citet[p. 5]{west2014linear}
se encuentra un recuento histórico referente a los modelos lineales desde sus inicios en 1861 hasta la actualidad, desde una perspectiva teórica, mencionando al igual avances importantes en cuanto a la implementación de las diferentes metodologías a nivel de paquetes estadísticos. Éstos tienen en cuenta una serie de supuestos lo que hace posible su planteamiento, estimación, interpretación y su respectiva evaluación. 
Las variables independientes pueden ser clasificadas como efectos fijos o efectos aleatorios. Acorde con \citet[p. 6]{Melo}, cuando al finalizar el experimento las conclusiones se formulan sobre un número preestablecido de tratamientos el modelo se denomina de efectos fijos y en este caso la inferencia estadística se hace sobre los efectos medios de los tratamientos, por lo cual aquellas situaciones en que se desean realizar comparaciones o contrastes entre niveles de un factor en búsqueda de diferencias, éste se considera como fijo. Si los niveles de un atributo son una muestra aleatoria de una población de posibles selecciones, es decir, las conclusiones se formulan sobre un número mayor de tratamientos a los usados en el experimento, el modelo se dice de efectos aleatorios, y en este caso, la inferencia estadística se hace sobre las varianzas de los mismos. Los modelos que incluyen ambos se denominan de efectos mixtos (MLM).



En términos matriciales, según \citet[p. 58]{bates2000mixed}, el modelo lineal general con efectos mixtos viene dado de la forma

\begin{equation}\label{marco:modmix}
\boldsymbol{y}_i=\boldsymbol{X}_i\boldsymbol{\beta}+\boldsymbol{Z}_{i}\boldsymbol{b}_{i}+\boldsymbol{\epsilon}_i,  \enspace \text{con} \enspace i=1,\cdots,n  \enspace \text{y} \enspace n=r\times a
\end{equation}


\noindent donde $\boldsymbol{y}_i$ es el vector de respuestas, $\boldsymbol{X}_i$ y $\boldsymbol{Z}_i$ son las matrices de diseño de los efectos fijos y aleatorios  asociadas al $i$-ésimo individuo, respectivamente. Los vectores $\boldsymbol{\beta}$ y $\boldsymbol{b}_{i}$ de dimensiones $a$ y $q$, que contienen los coeficientes asociados a los efectos fijos y aleatorios considerados, respectivamente, mientras que $\boldsymbol{\epsilon}_i$ es el vector de errores de mediciones. Como supuestos distribucionales sobre este modelo se asume que $\boldsymbol{b}_i \sim \boldsymbol{N}_q(\boldsymbol{0}_q,\boldsymbol{\Psi}_{q \times q})$ y $\boldsymbol{\epsilon}_i \sim \boldsymbol{N}_t(\boldsymbol{0}_t,\boldsymbol{\Sigma}_{t \times t})$. A su vez los vectores $\boldsymbol{\epsilon}_i$ y $\boldsymbol{b}_i$ se asumen independientes, es decir que $Cov(\boldsymbol{\epsilon}_i,\boldsymbol{b}_i)=0$. La matriz $\boldsymbol{\Sigma}$ asociada a los residuales dentro de las mediciones de la misma unidad puede considerar diferentes estructuras, es decir que se puede asociar a procesos autocorrelacionados, por ejemplo los que se encuentran en la literatura relacionada con series de tiempo, como los modelos \textit{ARIMA} \citep{wei2006time}, o como los que se estudian en la estadística espacial, que se caracterizan mediante su función de variograma \citep{schabenberger2017statistical}.

Las metodologías de estimación de los parámetros incluidos dentro del modelo son máxima verosimilitud o máxima verosimilitud restringida, a pesar de que en la literatura se encuentran diferentes propuestas. En este documento se utilizo la primera, ya que es la que se incluye por defecto dentro de la función $lme$ del paquete $nlme$ \citep{nlme} en R.

<!-- \section{Apéndice 2} -->

<!-- En esta sección se muestran las tablas resultantes de la estimación de la tasa de rentabilidad a nivel de sectores.  -->
<!-- Las tablas \@ref{tab:tsectoresnph} y \@ref{tab:tsectoresph} muestran los resultados para casas y apartamentos, respectivamente.  -->

<!-- ```{r echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- tar_load(table_taxes_PH_final) -->
<!-- tar_load(table_taxes_NPH_final) -->
<!-- table_taxes_PH_final <- table_taxes_PH_final %>% mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>%  -->
<!--     dplyr::select(ANO, CODIGO_LOCALIDAD, ESTRATO, CODIGO_BARRIO, TASA_RENTA) -->
<!-- table_taxes_NPH_final <- table_taxes_NPH_final %>% mutate(TASA_RENTA = round(1/TASA_RENTA, 5)) %>%  -->
<!--     dplyr::select(ANO, CODIGO_LOCALIDAD, ESTRATO, CODIGO_BARRIO, TASA_RENTA) -->
<!-- ``` -->

<!-- ```{r tsectoresnph, echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- table_taxes_PH_final %>%  rename("AÑO" = ANO) %>%  -->
<!--   kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para apartamentos, según los diferentes sectores catastrales y años.") %>%  -->
<!--   kable_styling(latex_options = c("hold_position",  "repeat_header", "striped")) -->
<!-- ``` -->

<!-- ```{r tsectoresph, echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- table_taxes_NPH_final %>% rename("AÑO" = ANO) %>%    -->
<!--   kbl(booktabs = TRUE, "latex", longtable = TRUE, caption = "Tasas de capitalización para casas, según los diferentes sectores catastrales y años.") %>%  -->
<!--   kable_styling(latex_options = c("hold_position",  "repeat_header", "striped")) -->
<!-- ``` -->





